## Quantime 前端文档

[Toc]

### 文档说明

​	感谢微信提供的宝贵机会！我们将会在本文档中自豪地介绍本团队开发的时间统计小程序 Quantime。这个名字取自一个物理学概念 Quantum time，时间量子，意味着时间是量子化的，有着最小单位，这与我们的时间统计哲学不谋而合。下面将会从单页面说明，页面逻辑，前端核心构思及实现等四个方面介绍我们的小程序。海德格尔说人类在根本上是时间性的存在，希望我们的小程序能够让大家的时间交错，让大家的存在共鸣，一起诗意地栖居。

### 单页面说明

#### 时间统计&表单信息

<img src="src\前端文档\image-20210525211842850.png" alt="image-20210525211842850" style="zoom: 50%;" />

​	这两个页面是用户与我们小程序的初见，第一个页面展示用户创建的统计分类和具体的表单(正如真机截图显示的那样，统计分类可以是一门课程，具体表单是某一次讨论)，这样子的二级设计有助于用户整理归纳自己创建的统计表单。同时，对于小组事务繁多的用户，我们提供了类和表单搜索功能，方便用户直达所需。

​	第二个页面展示表单的属性和方法，第一部分三个分栏跳转到不同的统计结果分析界面，展示不同视角的时间统计结果；第二部分两个分栏更改表单的状态，功能如其名，设置分布状态为”是“，在第一个页面中会有绿色”统计中“的标识，否则会有红色”已停止“的标识。第三个部分四个分栏展示表单的四个方法，分享表单会触发小程序自带的分享函数，跳转到分享页面，邀请微信好友或者群聊成员填写自己创建的表单，统计大家的时间。拷贝表单方法允许表单的复用，提高使用效率，移动表单和删除表单允许用户对表单进行改删。后三个方法均会触发模态框，辅助用户进行准确选择(如下图所示)

<img src="src\前端文档\image-20210525220009500.png" alt="image-20210525220009500" style="zoom: 50%;" />

#### 我的信息&类管理

<img src="src\前端文档\image-20210525221009352.png" alt="image-20210525221009352" style="zoom:50%;" />

​	我的信息页面提供对用户信息进行修改的方法，包括管理统计分类，查看保存的信息统计表单，还有用户反馈，查看版本信息等标准方法。类管理界面提供增加，删除，修改统计分类的方法，点击相关图标即可。新增类由模块框实现，所有操作均有自然的提示，用户操作友好。

<img src="src\前端文档\image-20210525232001929.png" alt="image-20210525232001929" style="zoom:50%;" />

#### 新建表单

​	新建表单包括两个关键页面，分别明确表单的属性和统计的时间段

##### 明确表单属性

<img src="src\前端文档\image-20210525233053463.png" alt="image-20210525233053463" style="zoom: 50%;" />

​	根据页面提示自然填写相关信息即可，类别选择使用了微信小程序自带API，让用户可以在窗口滑动选择。为了简便起见，允许用户统计的最大天数为3天，用户选择天数超过三天时会有提示消息，并让溢出的选择失败。简介处还可以填写额外的定制化约束，比如希望参与者选择连续的三个小时等，这样方可应对多样化的统计需求。

##### 明确统计时间段

<img src="src\前端文档\image-20210525234215307.png" alt="image-20210525234215307" style="zoom: 50%;" />

​	这一页面体现了我们站在统计者(如活动组织者，小组长等）角度，对时间统计的思考。正如我们的小程序名字Quantime，我们认为时间是量子的，有着最小的粒度(在这里是一小时)，所以我们提供了按小时点选的用户界面，统计者可以点击设置参与者们的可选时间，设置之后，参与者只需在设定的时间范围内提供自己的空余时间信息。

​	灰色模块表示未被选中，黄色模块表示被选中，用户可以在3天，3*24h内，自由组合，最大化挖掘可选时间，提高找到大家共同时间的概率。与以往用户直接指定可选时间段的模式相比，粒度化展示的时间能够让统计者思考更加具象化，能够考虑更全面；与以往人为提供多个时间段选项的统计方式相比，用户能够用合多为一，更加直观，也不用顾虑因为选项太多让参加者为难；**更重要的是，量子时间能够让碎片化时间得到充分利用，找到大家空闲时间意想不到的交集,** 这是依靠组织者先验确定可选时间段的传统方法无法做到的。这也是我们选择Quantime这种统计方式的原因。随后点击完成即可成功创建表单。

#### 填写表单

​	填写表单包括两个关键页面，分别告知参与者统计的目的和可选的时间段，与之前一致，我们采用时间量子的统计方式，**让参与者能够更精细地表达自己的空余时间，充分利用碎片时间**。

<img src="src\前端文档\image-20210526091259352.png" alt="image-20210526091259352" style="zoom:50%;" />

​	参与者点击组织发布在微信聊天中的小程序链接后，会进入邀请界面；在知晓统计目的之后，选择接受；在组织者同意的情况下(在表单属性中设置)，如果参与者希望了解统计结果，可以点击保存到我的，在我的信息->我保存的时间统计里面查看统计结果(但无权对于表单进行任何修改)

​	选择接受之后便进入时间统计页面，灰色的时间块表示无需填写，橙色的时间块表示统计者设置的可选时间，被点击时会切换为蓝色表示选中，最后点击完成即可，非常便捷。

#### 统计分析

<img src="src\前端文档\image-20210526102453413.png" alt="image-20210526102453413" style="zoom:50%;" />

​	在收集大家的可用时间后，Quantime会进行自动统计分析，并基于我们的时间统计理念，提供多样的可视化，帮助使用者一眼找出大家可用时间的重叠。受数据可视化中的热力图概念启发，我们提供了时间统计总览页面，时间块颜色越深表示在该时间段有空的人越多，统计者可以根据该页面快速总览时间统计结果。

​	此外，受到通讯录的启发，我们提供了带索引的参与者列表展示。统计者可以根据微信名拼写快速搜索相关参与者，定位还未参与统计的组织人员。

​	最后我们提供了时间统计详情页面，滑动时间条可以查看箭头所指时间段有空的人员，统计者可以根据与会人员信息最后确定合适的讨论开展时间。之后我们将会详细介绍这个页面的设计理念和实现方法。

#### 其他页面展示

<img src="src\前端文档\image-20210526110946778.png" alt="image-20210526110946778" style="zoom:50%;" />

​	第一次进入小程序的用户将会看到登录页面，点击获取权限授权小程序获取用户头像昵称等信息，最后可以在关于我们页面看到开发者和版本信息，我们是浙江大学求是潮工作团队，请多指教，欢迎来Github找我们玩耍。

### 页面交互逻辑

​	Quantime的页面逻辑和交互设计都追求自然，无需额外学习成本，使用者能够顺畅迅速上手。接下来将从统计者和参与者两个视角介绍页面逻辑。

#### 统计者

​	第一次登录的统计者将会见到上面所展示的登录界面，授权后进入时间统计页面。点击任意表单即可跳转表单信息界面。如果想要了解该表单的统计结果，点击表单信息页面的相关方法即可跳转相应统计界面。

​	点击新建表单按钮，进入新建表单界面，按照引导一步步填写相关信息即可跳转到下一个页面，最后点击完成会返回主页，可以点击新建的表单设置相关的状态并选择发送给微信好友或群聊。

![image-20210526123449927](src\前端文档\image-20210526123449927.png)

#### 参与者

​	参与者点击统计者分享的链接即可进入小程序，点击保存到我的能获得统计结果的一个拷贝，了解时间统计情况；点击接受即可参与发布者的时间统计，跳转到时间统计页面，点选自己的合适时间，点击完成即可。随后会跳转到自己的主页(如果是第一次登录会跳转到授权页面)，参与者可以在我的信息->我保存的时间统计看到自己之前拷贝的统计结果，了解时间统计情况。

![image-20210526124806011](src\前端文档\image-20210526124806011.png)



​	作为用户来说，可以在”我的信息“页面更新用户信息，管理自己定义的统计类，查看已保存的统计表单，看到小程序的版本信息和更新日志，并能向我们反馈宝贵的意见。下图从左到右依次是”查看已保存的统计表单“，”用户反馈“，”更新日志“页面。

<img src="src\前端文档\image-20210526130223002.png" alt="image-20210526130223002" style="zoom: 60%;" />

### 前端核心构思和实现

​	Quantime最核心的前端是时间块组件，下面将分享我们的想法和实现方法。

<img src="src\前端文档\image-20210526131906813.png" alt="image-20210526131906813" style="zoom: 50%;" />

​	时间块由三部分组成：最上面的时间传送带(可滑动)，固定在屏幕中央的箭头，最下面的时间轴。正如之前所提到，用户能够滑动时间块(第一张图绿色框内部分）查看箭头所指的时间段有空的具体人员(第三张图绿色框出部分的时间轴帮助辨认目前箭头所在时间段）。时间块本身也具有热度图显示，人数多的时间块具有更深的颜色，在把握总体和细节之间取得平衡。点击时间块两侧的箭头可以切换查看的日期。

​	这样设计的初心是，想要提供更直观自然的统计分析结果展示。用户不用输入具体日期和时间段，不用面对统计柱状图，什么都不用输入，触屏滑动即可尽得俯仰之妙，获取各种角度的统计结果展示；同时热度图和名单索引列表，让用户对于统计结果有更直接的感知，也能更准确得找到关键的参与者。通过非常直观自然的界面，没有障碍地获取丰富的信息，从而辅助统计者快速定夺活动举办或者会议开展的时间。

​	在实现上，将时间传送带和时间轴放在一个Scroll-view中，利用wx-for单独渲染每一个时间段和时间结点，利用fixed布局固定屏幕中央的箭头和传送带两边的箭头，整体包装成一个组件，利用属性以数组形式接受一天内的各个时间段的人数。在JS中利用时间段-人数数组计算每个时间块的颜色rgb值，并利用微信小程序框架的动态属性绑定机制，让每一个时间块根据该时间拥有的人数呈现不同深浅的色彩。

​	该组件最大的难点在于如何获取中央箭头目前所指的时间段，从而能够显示在该时间段有空的人。经过我们的思考，采用了一个巧妙的方法，下面介绍大致的想法：

- 首先利用Wxss方便的rpx机制，结合百分比(%)设置时间块各部分的宽度，做到自适应布局，这样才能保证，不同大小的屏幕，时间块总是在正中间，而且时间传送带一次恰好只能显示十个时间段，这样箭头一开始总是指向固定的时间段(这一点非常重要)

- 引入空白的时间轴和时间传送带item，实现padding的效果，从而箭头一开始一定指向0点到1点这一时间段。

- 利用scroll-view原生的scroll方法，获取传送带已经滑动的绝对距离，利用getSystemInfoSync()方法获取当前设备屏幕宽度，计算每一个时间传送带中每一个时间段item的宽度，传送带滑动的距离除以每一个item的宽度即可知道此时已经划过了多少个时间段item；结合一定是从0点-1点时间段item开始，可以计算出现在中央箭头指向的时间段item。

- 利用observers机制监听中央箭头指向的时间段item以及日期是否变化，若变化则向父页面传值，父页面获取目前中央箭头指向的时间段信息后，即可准备好并更新相应数据，渲染出当前时间段有空闲时间的人。

  核心代码如下：

```javascript
//数据监视，向父页面传值
observers:{
    'Current, date': function(Current, date){
      var MyDetails = {
        'Day':date,
        'Hour':Current
      } 
      this.triggerEvent('ChangePeople', MyDetails)
    }
  },
//利用滑动距离，计算获得当前中央箭头指向的时间段
scroll:function(e){
      var dist = e.detail.scrollLeft
      var Cur = (parseInt(dist/this.data.width+this.data.Current/24))%24;
      if(Cur != this.data.Current)// 有变化时才更新，因为scroll方法会被频繁触发
      {
          this.setData({
          Current:Cur
        })
      }
    },
```


